---
title: 多线程的资源同步和线程安全、锁
date: 2019-10-14 22:44:08
tags:
- 多线程
categories:
- 多线程
---

## 数据同步

首先为什么要同步？

普通的程序在[串行化](https://baike.baidu.com/item/%E4%B8%B2%E8%A1%8C%E5%8C%96/455112?fr=aladdin)任务执行的过程中不存在线程安全、资源共享的情况，但是效率低下资源无法得到充分应用；A餐厅等他吃完了，b才能进来吃.

资源共享就是多个线程同时对同一个资源进行访问。资源同步就是多个线程访问到的数据都是相同的。

引入之前的[例子](https://www.zhbzdnb.com/2019/09/08/%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80No-2/)

使用之前用静态关键字进行解决的例子 多次运行对比结果

```
public class Threadsharedresource extends  Thread{
    private final  String  number;//人事编号
    private static final int MAX=50;
    private static int index=1;
     public  void run(){
         while(index<=MAX)
         {
             System.out.println("人事"+number+"招聘到了 第"+(index++)+"个java开发");
         }
     }
     public Threadsharedresource(String number)
     {
                 this.number=number;
     }
     public static void main(String[] args)
     {
              Threadsharedresource tsd1=new Threadsharedresource("001");
                tsd1.start();
               Threadsharedresource tsd2=new Threadsharedresource("002");
                tsd2.start();
               Threadsharedresource tsd3=new Threadsharedresource("003");
                tsd3.start();
       }
}

```

### 多次显示

![1571065968768](多线程的共享资源和资源同步\1571065968768.png)

线程1执行498+1还没执行完成，执行权到了线程2的手里也执行498+1.所以就出现了俩499

### 被略过

![1571067068853](多线程的共享资源和资源同步\1571067068853.png)

这个和上个问题有些相似，线程1 2都得到了index=8的位置  线程1执行了9+1 ，还未执行输出，执行权到了线程2 线程2执行10+1了。 那么线程1输出11 

### 超过最大值

![1571067931007](多线程的共享资源和资源同步\1571067931007.png)

这个就是线程1 线程2 线程3 执行到499 3个线程都进入了while里面

```
 while(index<=MAX)
        {
            System.out.println("人事"+Thread.currentThread()+"招聘到了 第"+(index++)+"个java开发");
            try {
                Thread.sleep(100);
            }catch (InterruptedException e)
            {
                e.printStackTrace();
            }
        }
```

此时其中某个线程获得了执行权+1 其他的渐渐的也获得了权力 +1 +1 导致最后结果为502

未完成、待续；